import{h as _,d as n,j as y,r as m,k as M,l as E,c as p,f as $,m as q,n as D,o as S,a as A}from"./script-_KeQWcTo.js";import{T as L,M as F,E as W}from"./tabs-6DsrmTik.js";import{J as R}from"./just-validate.es-C73wyOde.js";import{P as z}from"./pop-up-Cl5BhUHu.js";import"./inputmask-CsGDK5Eu.js";class B{petId;imgPath;imgWebPPath;constructor(e,t,r){this.petId=e,this.imgPath=t,this.imgWebPPath=r,this.deletePetFromDB()}async deletePetFromDB(){try{const e=_(n,"pats",this.petId);await y(e),this.imgPath&&await this.deleteImageFromStorage(this.imgPath),this.imgWebPPath&&await this.deleteImageFromStorage(this.imgWebPPath),this.updateUIAfterDelete()}catch(e){console.error("Error deleting pet: ",e)}}async deleteImageFromStorage(e){try{const t=m(M,e);await E(t),console.log(`Image ${e} deleted successfully from Firebase Storage`)}catch(t){console.error(`Error deleting image ${e}: `,t)}}updateUIAfterDelete(){const e=document.querySelector(`.pet.${this.petId}`);e&&e.remove()}}class H{cardHolder;patsArr;constructor(e){this.cardHolder=document.querySelector(e),this.patsArr=[],this.init()}init(){this.conectDBPet()}async conectDBPet(){try{const e=p(n,"pats");(await $(e)).forEach(r=>{const a=r.data();this.patsArr.push({id:r.id,img:a.img||"",imgWebP:a.imgWebP,name:a.name||"No Name",shortInfo:a.shortInfo||"",view:a.view||"",owner:a.owner||""})}),this.renderPat(this.patsArr)}catch(e){console.error(e)}}renderPat(e){this.cardHolder.innerHTML="",e.forEach(t=>{const r=`
        <div class="list__item pet ${t.id}">
          <div class="pet__info">
            <div class="pet__viev">${t.view}</div>
  
            <div class="pet__img">
              <picture>
                <source srcset=${t.imgWebP} type="image/webp" />
                <img src="${t.img}" alt="pet image" />
              </picture>
            </div>
  
            <p class="pet__name">${t.name}</p>
            <p class="pet__short-info">${t.shortInfo}</p>
            ${t.owner?`<p class="pet__owner">Є опікун: ${t.owner} (ID)</p>`:""}
          </div>
  
          <div class="pet__btns">
            <a href="one-pet.html?id=${t.id}" class="pet__page btn gradient">Переглянути</a>
            <button class="pet__edit btn gradient">Редагувати</button>
            <button class="pet__del btn gradient" data-id="${t.id}" data-img="${t.img}" data-img-webp="${t.imgWebP}">Видалити</button>
          </div>
        </div>
      `;this.cardHolder.insertAdjacentHTML("beforeend",r)}),this.addDeleteEventListeners()}addDeleteEventListeners(){this.cardHolder.querySelectorAll(".pet__del").forEach(t=>{t.addEventListener("click",r=>{const a=r.target.getAttribute("data-id"),o=r.target.getAttribute("data-img"),s=r.target.getAttribute("data-img-webp");a&&o&&s&&new B(a,o,s)})})}}class U{formId;validator;btn;constructor(e){this.formId=e,this.validator=new R(this.formId),this.btn=document.querySelector(".all-pet__add"),this.init()}init(){this.btn.addEventListener("click",()=>{new z(".pop-up-new-pet"),this.initializeValidation()})}async uploadImage(e,t){const r=q(),a=m(r,t);try{return await D(a,e),await S(a)}catch(o){throw console.error("Error uploading image: ",o),o}}async updateData(){const e=document.querySelector("#name-pet"),t=document.querySelector("#breed"),r=document.querySelector("#age"),a=document.querySelector("#short-info"),o=document.querySelector("#full-info"),s=document.querySelector("#viev"),d=document.querySelector("#img-jpg"),c=document.querySelector("#img-webp");if(!e||!t||!r||!a||!o||!s||!d||!c){console.error("One or more input elements are not found in the DOM");return}const h=e.value,f=t.value,v=r.value,b=a.value,w=o.value,I=s.value,u=d.files?.[0],g=c.files?.[0];if(!u||!g){console.error("Both image files (JPG and WebP) must be selected.");return}try{const i=await this.uploadImage(u,`pats/${Date.now()}.jpg`),P=await this.uploadImage(g,`pats/${Date.now()}.webp`);await A(p(n,"pats"),{name:h,breed:f,age:v,shortInfo:b,fullInfo:w,img:i,imgWebP:P,view:I}),console.log("Pet added successfully"),location.reload()}catch(i){console.error("Error adding pet data:",i)}}initializeValidation(){this.validator.addField("#viev",[{rule:"required",errorMessage:"Ведіть дані"},{rule:"minLength",value:2,errorMessage:"Дані мають містити більше символів"},{rule:"customRegexp",value:/^[А-Яа-яЁёІіЇїЄєҐґA-Za-z]{2,}$/,errorMessage:"Дані мають містити лише літери"}]).addField("#name-pet",[{rule:"required",errorMessage:"Ведіть ім'я"},{rule:"minLength",value:2,errorMessage:"Ім'я має містити більше символів"},{rule:"customRegexp",value:/^[А-Яа-яЁёІіЇїЄєҐґA-Za-z]{2,}$/,errorMessage:"Ім'я має містити лише літери"}]).addField("#breed",[{rule:"required",errorMessage:"Ведіть породу"},{rule:"minLength",value:2,errorMessage:"Порода має містити більше символів"},{rule:"customRegexp",value:/^[a-zа-яёіїє\s]+$/,errorMessage:"Порода має містити лише маленькі літери"}]).addField("#age",[{rule:"required",errorMessage:"Вкажіть вік"},{rule:"minLength",value:5,errorMessage:"Вік має містити більше символів"},{rule:"customRegexp",value:/^[a-zа-яіїєґ0-9\s]+$/,errorMessage:"Вік має містити лише маленькі літери, цифри або пробіли"}]).addField("#short-info",[{rule:"required",errorMessage:"Заповніть коротку інформацію."},{rule:"minLength",value:10,errorMessage:"Коротка інформація має містити більше символів."},{rule:"customRegexp",value:/^[A-Za-zА-Яа-яЁёІіЇїЄєҐґ0-9\s,.;?!(){}[\]<>:"'–-]+$/,errorMessage:"Коротка інформація має містити лише літери, цифри, пробіли та дозволені знаки припинання."}]).addField("#full-info",[{rule:"required",errorMessage:"Заповніть повну інформацію."},{rule:"minLength",value:5,errorMessage:"Повна інформація має містити більше символів."},{rule:"customRegexp",value:/^[A-Za-zА-Яа-яЁёІіЇїЄєҐґ0-9\s,.;?!(){}[\]<>:"'–-]+$/,errorMessage:"Повна інформація має містити лише літери, цифри, пробіли та дозволені знаки припинання."}]).addField("#img-jpg",[{rule:"required",errorMessage:"Завантажте картинку"}]).addField("#img-webp",[{rule:"required",errorMessage:"Завантажте картинку"}]).onSuccess(e=>{e.preventDefault(),this.updateData().then(()=>{setTimeout(()=>{location.reload()},2e3)})})}}document.addEventListener("DOMContentLoaded",async()=>{new L(".tabs__nav-btn",".tabs__item"),new F,new W("#form-edit"),new H(".list"),new U("#form-new-pet")});
